2025-10-22  15:48  v0.2  —  Attempt 1
Integrated gallery aspect-ratio logic into Squarespace build.
- Added namespace `.apreps` via Header Code Injection.
- Implemented scoped CSS in Custom CSS to enforce 3:4 (portrait) and 4:3 (landscape) crops, flush-top alignment, and left-aligned captions.
- Replaced old footer JS with v0.2 script tagging `.slide` wrappers using `data-image-dimensions`.
- Added re-scan triggers for tab changes and Squarespace content refresh events.
Purpose: ensure consistent gallery aspect ratio across artist pages without global overrides.
Nice—this is perfect. I can see the real structure:
	•	Tabs wrapper → .tab-panel.active
	•	Section type → .page-section with typeName: "portfolio-grid-overlay"
	•	Gallery block → .sqs-block.gallery-block
	•	Items → .sqs-gallery-design-grid .slide
	•	Image inside → .thumb-image (with data-image-dimensions="WxH")

Let’s lock it in cleanly and move on.

Paste these in

1) Add a site namespace (once, in Header Code Injection)

Keeps our rules from going global.

<script>document.documentElement.classList.add('apreps');</script>

2) CSS (end of Custom CSS)

This ignores Squarespace’s grid sizing and enforces 3:4 (portrait) and 4:3 (landscape) per item. It also left-aligns captions.

/* ===== AP—REPS v0.2 — Gallery crop on grid slides (scoped) ===== */
.apreps .tab-panel .page-section .sqs-gallery.sqs-gallery-design-grid .slide {
  position: relative;
}

.apreps .tab-panel .page-section .sqs-gallery.sqs-gallery-design-grid .margin-wrapper {
  position: relative;
  overflow: hidden;
}

/* Aspect boxes on the wrapper, class goes on .slide */
.apreps .sqs-gallery.sqs-gallery-design-grid .slide.portrait  .margin-wrapper::before { content:""; display:block; padding-top:133.333%; } /* 3:4 */
.apreps .sqs-gallery.sqs-gallery-design-grid .slide.landscape .margin-wrapper::before { content:""; display:block; padding-top:75%; }       /* 4:3 */

/* Fill the box, flush-top crop */
.apreps .sqs-gallery.sqs-gallery-design-grid .margin-wrapper .image-slide-anchor,
.apreps .sqs-gallery.sqs-gallery-design-grid .margin-wrapper img.thumb-image {
  position: absolute !important;
  inset: 0 !important;
  width: 100% !important;
  height: 100% !important;
}

.apreps .sqs-gallery.sqs-gallery-design-grid .margin-wrapper img.thumb-image {
  object-fit: cover;
  object-position: top center;
  display: block;
}

/* Caption alignment (if titles/descriptions are shown) */
.apreps .sqs-gallery-block-show-meta .image-slide-title,
.apreps .sqs-gallery-block-show-meta .sqs-block-caption,
.apreps .sqs-gallery-block-show-meta .image-meta {
  text-align: left !important;
  margin-top: .5rem;
  line-height: 1.3;
}

/* Optional: kill built-in square/specific AR styles trying to size the grid */
.apreps .sqs-gallery-block-grid [style*="width:"],
.apreps .sqs-gallery-block-grid [style*="height:"] {
  /* Do not nuke everything — we override only the image/anchor above */
}

3) JS (bottom of Footer Code Injection, below the Tabs script)

Tags each .slide as portrait or landscape. Runs on load + tab change.

<!-- AP—REPS v0.2 — classify slides by orientation -->
<script>
(function(){
  function classify(img){
    if(!img) return;
    var slide = img.closest('.sqs-gallery-design-grid .slide');
    if(!slide) return;

    // Prefer explicit dimensions if present
    var dim = img.getAttribute('data-image-dimensions'); // "W x H" or "WxH"
    var w=0,h=0;
    if (dim && /(\d+)\s*x\s*(\d+)/i.test(dim)) {
      var m = dim.match(/(\d+)\s*x\s*(\d+)/i);
      w = +m[1]; h = +m[2];
    } else if (img.naturalWidth && img.naturalHeight) {
      w = img.naturalWidth; h = img.naturalHeight;
    }
    if(!(w && h)) return;

    var land = w > h;
    slide.classList.toggle('landscape', land);
    slide.classList.toggle('portrait', !land);
  }

  function scan(root){
    (root || document)
      .querySelectorAll('.apreps .tab-panel.active .sqs-gallery.sqs-gallery-design-grid img.thumb-image')
      .forEach(function(img){
        if (img.complete && (img.naturalWidth || img.getAttribute('data-image-dimensions'))) classify(img);
        else img.addEventListener('load', function on(){ img.removeEventListener('load', on); classify(img); });
      });
  }

  document.addEventListener('DOMContentLoaded', function(){ scan(); });

  // Will Myers Tabs emits aria-hidden toggles; re-scan after click
  document.addEventListener('click', function(e){
    var isTabBtn = e.target.closest('.tabs-header [role="tab"], .tabs-header button');
    if (isTabBtn) setTimeout(scan, 60);
  });

  // Squarespace content refresh hook
  document.addEventListener('sqs-content-loaded', function(e){
    scan(e.detail ? e.detail.target : document);
  });
})();
</script>

Quick verification (one minute)

On the front-end page (not the editor):
	1.	DevTools → Console:

[...document.querySelectorAll('.sqs-gallery.sqs-gallery-design-grid .slide.portrait, .sqs-gallery.sqs-gallery-design-grid .slide.landscape')].length

You should get a number > 0.
	2.	Temporary visual check (throw in Custom CSS, then remove later):

.sqs-gallery.sqs-gallery-design-grid .slide.portrait  { outline: 2px solid blue; }
.sqs-gallery.sqs-gallery-design-grid .slide.landscape { outline: 2px solid red; }

You’ll see blue vs red boxes; crops should be top-flush.

⸻

If any artist page uses a different section type (not portfolio-grid-overlay), tell me the class on that <section> and I’ll add a second scope line. Otherwise, this set matches your DOM and won’t spill onto other pages.





